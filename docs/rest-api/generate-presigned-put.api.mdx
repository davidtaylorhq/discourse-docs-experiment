---
id: generate-presigned-put
title: "Initiates a direct external upload"
description: "Direct external uploads bypass the usual method of creating uploads"
sidebar_label: "Initiates a direct external upload"
hide_title: true
hide_table_of_contents: true
api: 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
sidebar_class_name: "post api-method"
info_path: docs/rest-api/discourse-api-documentation
custom_edit_url: null
hide_send_button: true
---

import ApiTabs from "@theme/ApiTabs";
import DiscriminatorTabs from "@theme/DiscriminatorTabs";
import MethodEndpoint from "@theme/ApiExplorer/MethodEndpoint";
import SecuritySchemes from "@theme/ApiExplorer/SecuritySchemes";
import MimeTabs from "@theme/MimeTabs";
import ParamsItem from "@theme/ParamsItem";
import ResponseSamples from "@theme/ResponseSamples";
import SchemaItem from "@theme/SchemaItem";
import SchemaTabs from "@theme/SchemaTabs";
import Markdown from "@theme/Markdown";
import OperationTabs from "@theme/OperationTabs";
import TabItem from "@theme/TabItem";

<h1 className={"openapi__heading"}>Initiates a direct external upload</h1>

<MethodEndpoint method={"post"} path={"/uploads/generate-presigned-put.json"}></MethodEndpoint>



Direct external uploads bypass the usual method of creating uploads
via the POST /uploads route, and upload directly to an external provider,
which by default is S3. This route begins the process, and will return
a unique identifier for the external upload as well as a presigned URL
which is where the file binary blob should be uploaded to.

Once the upload is complete to the external service, you must call the
POST /complete-external-upload route using the unique identifier returned
by this route, which will create any required Upload record in the Discourse
database and also move file from its temporary location to the final
destination in the external storage service.

You must have the correct permissions and CORS settings configured in your
external provider. We support AWS S3 as the default. See:

https://meta.discourse.org/t/-/210469#s3-multipart-direct-uploads-4.

An external file store must be set up and `enable_direct_s3_uploads` must
be set to true for this endpoint to function.



## Request

<MimeTabs className={"openapi-tabs__mime"}><TabItem label={"application/json"} value={"application/json-schema"}><details style={{}} className={"openapi-markdown__details mime"} data-collapsed={false} open={true}><summary style={{}} className={"openapi-markdown__details-summary-mime"}><h3 className={"openapi-markdown__details-summary-header-body"}>Body</h3></summary><div style={{"textAlign":"left","marginLeft":"1rem"}}></div><ul style={{"marginLeft":"1rem"}}><SchemaItem collapsible={false} name={"type"} required={true} schemaName={"string"} qualifierMessage={"**Possible values:** [`avatar`, `profile_background`, `card_background`, `custom_emoji`, `composer`]"} schema={{"type":"string","enum":["avatar","profile_background","card_background","custom_emoji","composer"]}}></SchemaItem><SchemaItem collapsible={false} name={"file_name"} required={true} schemaName={"string"} qualifierMessage={undefined} schema={{"type":"string","example":"IMG_2021.jpeg"}}></SchemaItem><SchemaItem collapsible={false} name={"file_size"} required={true} schemaName={"integer"} qualifierMessage={undefined} schema={{"type":"integer","description":"File size should be represented in bytes.","example":4096}}></SchemaItem><SchemaItem collapsible={true} className={"schemaItem"}><details style={{}} className={"openapi-markdown__details"}><summary style={{}}><span className={"openapi-schema__container"}><strong className={"openapi-schema__property"}>metadata</strong><span className={"openapi-schema__name"}> object</span></span></summary><div style={{"marginLeft":"1rem"}}><SchemaItem collapsible={false} name={"sha1-checksum"} required={false} schemaName={"string"} qualifierMessage={undefined} schema={{"type":"string","description":"The SHA1 checksum of the upload binary blob. Optionally be provided and serves as an additional security check when later processing the file in complete-external-upload endpoint."}}></SchemaItem></div></details></SchemaItem></ul></details></TabItem></MimeTabs><div><div><ApiTabs label={undefined} id={undefined}><TabItem label={"200"} value={"200"}><div>

external upload initialized

</div><div><MimeTabs className={"openapi-tabs__mime"} schemaType={"response"}><TabItem label={"application/json"} value={"application/json"}><SchemaTabs className={"openapi-tabs__schema"}><TabItem label={"Schema"} value={"Schema"}><details style={{}} className={"openapi-markdown__details response"} data-collapsed={false} open={true}><summary style={{}} className={"openapi-markdown__details-summary-response"}><strong>Schema</strong></summary><div style={{"textAlign":"left","marginLeft":"1rem"}}></div><ul style={{"marginLeft":"1rem"}}><SchemaItem collapsible={false} name={"key"} required={false} schemaName={"string"} qualifierMessage={undefined} schema={{"type":"string","description":"The path of the temporary file on the external storage service.","example":"temp/site/uploads/default/12345/67890.jpg"}}></SchemaItem><SchemaItem collapsible={false} name={"url"} required={false} schemaName={"string"} qualifierMessage={undefined} schema={{"type":"string","description":"A presigned PUT URL which must be used to upload the file binary blob to.","example":"https://file-uploads.s3.us-west-2.amazonaws.com/temp/site/uploads/default/123/456.jpg?x-amz-acl=private&x-amz-meta-sha1-checksum=sha1&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AAAAus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20211221T011246Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=12345678"}}></SchemaItem><SchemaItem collapsible={false} name={"signed_headers"} required={false} schemaName={"object"} qualifierMessage={undefined} schema={{"type":"object","description":"A map of headers that must be sent with the PUT request.","example":{"x-amz-acl":"private","x-amz-meta-sha1-checksum":"sha1"}}}></SchemaItem><SchemaItem collapsible={false} name={"unique_identifier"} required={false} schemaName={"string"} qualifierMessage={undefined} schema={{"type":"string","description":"A unique string that identifies the external upload. This must be stored and then sent in the /complete-external-upload endpoint to complete the direct upload.","example":"66e86218-80d9-4bda-b4d5-2b6def968705"}}></SchemaItem></ul></details></TabItem><TabItem label={"Example (from schema)"} value={"Example (from schema)"}><ResponseSamples responseExample={"{\n  \"key\": \"temp/site/uploads/default/12345/67890.jpg\",\n  \"url\": \"https://file-uploads.s3.us-west-2.amazonaws.com/temp/site/uploads/default/123/456.jpg?x-amz-acl=private&x-amz-meta-sha1-checksum=sha1&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AAAAus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20211221T011246Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=12345678\",\n  \"signed_headers\": {\n    \"x-amz-acl\": \"private\",\n    \"x-amz-meta-sha1-checksum\": \"sha1\"\n  },\n  \"unique_identifier\": \"66e86218-80d9-4bda-b4d5-2b6def968705\"\n}"} language={"json"}></ResponseSamples></TabItem></SchemaTabs></TabItem></MimeTabs></div></TabItem></ApiTabs></div></div>
      