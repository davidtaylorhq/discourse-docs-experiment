---
id: complete-external-upload
title: "Completes a direct external upload"
description: "Completes an external upload initialized with /get-presigned-put. The"
sidebar_label: "Completes a direct external upload"
hide_title: true
hide_table_of_contents: true
api: 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
sidebar_class_name: "post api-method"
info_path: docs/rest-api/discourse-api-documentation
custom_edit_url: null
hide_send_button: true
---

import ApiTabs from "@theme/ApiTabs";
import DiscriminatorTabs from "@theme/DiscriminatorTabs";
import MethodEndpoint from "@theme/ApiExplorer/MethodEndpoint";
import SecuritySchemes from "@theme/ApiExplorer/SecuritySchemes";
import MimeTabs from "@theme/MimeTabs";
import ParamsItem from "@theme/ParamsItem";
import ResponseSamples from "@theme/ResponseSamples";
import SchemaItem from "@theme/SchemaItem";
import SchemaTabs from "@theme/SchemaTabs";
import Markdown from "@theme/Markdown";
import OperationTabs from "@theme/OperationTabs";
import TabItem from "@theme/TabItem";

<h1 className={"openapi__heading"}>Completes a direct external upload</h1>

<MethodEndpoint method={"post"} path={"/uploads/complete-external-upload.json"}></MethodEndpoint>



Completes an external upload initialized with /get-presigned-put. The
file will be moved from its temporary location in external storage to
a final destination in the S3 bucket. An Upload record will also be
created in the database in most cases.

If a sha1-checksum was provided in the initial request it will also
be compared with the uploaded file in storage to make sure the same
file was uploaded. The file size will be compared for the same reason.

You must have the correct permissions and CORS settings configured in your
external provider. We support AWS S3 as the default. See:

https://meta.discourse.org/t/-/210469#s3-multipart-direct-uploads-4.

An external file store must be set up and `enable_direct_s3_uploads` must
be set to true for this endpoint to function.



## Request

<MimeTabs className={"openapi-tabs__mime"}><TabItem label={"application/json"} value={"application/json-schema"}><details style={{}} className={"openapi-markdown__details mime"} data-collapsed={false} open={true}><summary style={{}} className={"openapi-markdown__details-summary-mime"}><h3 className={"openapi-markdown__details-summary-header-body"}>Body</h3></summary><div style={{"textAlign":"left","marginLeft":"1rem"}}></div><ul style={{"marginLeft":"1rem"}}><SchemaItem collapsible={false} name={"unique_identifier"} required={true} schemaName={"string"} qualifierMessage={undefined} schema={{"type":"string","example":"66e86218-80d9-4bda-b4d5-2b6def968705","description":"The unique identifier returned in the original /generate-presigned-put request."}}></SchemaItem><SchemaItem collapsible={false} name={"for_private_message"} required={false} schemaName={"string"} qualifierMessage={undefined} schema={{"type":"string","example":"true","description":"Optionally set this to true if the upload is for a private message."}}></SchemaItem><SchemaItem collapsible={false} name={"for_site_setting"} required={false} schemaName={"string"} qualifierMessage={undefined} schema={{"type":"string","example":"true","description":"Optionally set this to true if the upload is for a site setting."}}></SchemaItem><SchemaItem collapsible={false} name={"pasted"} required={false} schemaName={"string"} qualifierMessage={undefined} schema={{"type":"string","example":"true","description":"Optionally set this to true if the upload was pasted into the upload area. This will convert PNG files to JPEG."}}></SchemaItem></ul></details></TabItem></MimeTabs><div><div><ApiTabs label={undefined} id={undefined}><TabItem label={"200"} value={"200"}><div>

external upload initialized

</div><div><MimeTabs className={"openapi-tabs__mime"} schemaType={"response"}><TabItem label={"application/json"} value={"application/json"}><SchemaTabs className={"openapi-tabs__schema"}><TabItem label={"Schema"} value={"Schema"}><details style={{}} className={"openapi-markdown__details response"} data-collapsed={false} open={true}><summary style={{}} className={"openapi-markdown__details-summary-response"}><strong>Schema</strong></summary><div style={{"textAlign":"left","marginLeft":"1rem"}}></div><ul style={{"marginLeft":"1rem"}}><SchemaItem collapsible={false} name={"id"} required={true} schemaName={"integer"} qualifierMessage={undefined} schema={{"type":"integer"}}></SchemaItem><SchemaItem collapsible={false} name={"url"} required={true} schemaName={"string"} qualifierMessage={undefined} schema={{"type":"string"}}></SchemaItem><SchemaItem collapsible={false} name={"original_filename"} required={true} schemaName={"string"} qualifierMessage={undefined} schema={{"type":"string"}}></SchemaItem><SchemaItem collapsible={false} name={"filesize"} required={true} schemaName={"integer"} qualifierMessage={undefined} schema={{"type":"integer"}}></SchemaItem><SchemaItem collapsible={false} name={"width"} required={true} schemaName={"integer"} qualifierMessage={undefined} schema={{"type":"integer"}}></SchemaItem><SchemaItem collapsible={false} name={"height"} required={true} schemaName={"integer"} qualifierMessage={undefined} schema={{"type":"integer"}}></SchemaItem><SchemaItem collapsible={false} name={"thumbnail_width"} required={true} schemaName={"integer"} qualifierMessage={undefined} schema={{"type":"integer"}}></SchemaItem><SchemaItem collapsible={false} name={"thumbnail_height"} required={true} schemaName={"integer"} qualifierMessage={undefined} schema={{"type":"integer"}}></SchemaItem><SchemaItem collapsible={false} name={"extension"} required={true} schemaName={"string"} qualifierMessage={undefined} schema={{"type":"string"}}></SchemaItem><SchemaItem collapsible={false} name={"short_url"} required={true} schemaName={"string"} qualifierMessage={undefined} schema={{"type":"string"}}></SchemaItem><SchemaItem collapsible={false} name={"short_path"} required={true} schemaName={"string"} qualifierMessage={undefined} schema={{"type":"string"}}></SchemaItem><SchemaItem collapsible={false} name={"retain_hours"} required={true} schemaName={["string","null"]} qualifierMessage={undefined} schema={{"type":["string","null"]}}></SchemaItem><SchemaItem collapsible={false} name={"human_filesize"} required={true} schemaName={"string"} qualifierMessage={undefined} schema={{"type":"string"}}></SchemaItem><SchemaItem collapsible={false} name={"dominant_color"} required={false} schemaName={["string","null"]} qualifierMessage={undefined} schema={{"type":["string","null"]}}></SchemaItem></ul></details></TabItem><TabItem label={"Example (from schema)"} value={"Example (from schema)"}><ResponseSamples responseExample={"{\n  \"id\": 0,\n  \"url\": \"string\",\n  \"original_filename\": \"string\",\n  \"filesize\": 0,\n  \"width\": 0,\n  \"height\": 0,\n  \"thumbnail_width\": 0,\n  \"thumbnail_height\": 0,\n  \"extension\": \"string\",\n  \"short_url\": \"string\",\n  \"short_path\": \"string\",\n  \"human_filesize\": \"string\"\n}"} language={"json"}></ResponseSamples></TabItem></SchemaTabs></TabItem></MimeTabs></div></TabItem></ApiTabs></div></div>
      